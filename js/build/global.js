/*
	 * jquery.simulate - simulate browser mouse and keyboard events
	 *
	 * Copyright (c) 2009 Eduardo Lundgren (eduardolundgren@gmail.com)
	 * and Richard D. Worth (rdworth@gmail.com)
	 *
	 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
	 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
	 *
	 */

define(["jquery","backbone"],function(e){_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g};var t=function(e){var t=function(e){var t=e.split("|"),n;e=t.shift(),n=Serenity._translations[Serenity.language][e]||e;while(t.length)n=n.replace("{}",this.translate(t.shift()));return n},n=t(e.data("translate"));e.is("input")?e.attr("placeholder",n):e.is("optgroup")?e.attr("label",n):e.html(n)};e.fn.extend({translate:function(){var n=this.find("[data-translate]");return n.length===0&&this.data("translate")?t(this):e.each(n,function(){t(e(this))}),this},toJSON:function(t){t=t||"name";var n=this.find("input, select, textarea"),r={};return e.each(n,function(){var n=e(this);if(!n.is(":disabled")&&n.attr(t)&&!n.is(":radio")||n.is(":radio")&&n.is(":checked"))r[n.attr(t)]=n.val()}),r},onAvailable:function(t){var n=this.selector,r=e(n),i;this.length>0?t.call(this,r):i=setInterval(function(){r=e(n),r.length>0&&(t.call(r,r),clearInterval(i))},150)},are:function(e){return!!e&&this.filter(e).length===this.length}}),function(e){e.fn.extend({simulate:function(t,n){return this.each(function(){var r=e.extend({},e.simulate.defaults,n||{});new e.simulate(this,t,r)})}}),e.simulate=function(e,t,n){this.target=e,this.options=n,/^drag$/.test(t)?this[t].apply(this,[this.target,n]):this.simulateEvent(e,t,n)},e.extend(e.simulate.prototype,{simulateEvent:function(e,t,n){var r=this.createEvent(t,n);return this.dispatchEvent(e,t,r,n),r},createEvent:function(e,t){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(e))return this.mouseEvent(e,t);if(/^key(up|down|press)$/.test(e))return this.keyboardEvent(e,t)},mouseEvent:function(t,n){var r,i=e.extend({bubbles:!0,cancelable:t!="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:undefined},n),s=e(i.relatedTarget)[0];return e.isFunction(document.createEvent)?(r=document.createEvent("MouseEvents"),r.initMouseEvent(t,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget||document.body.parentNode)):document.createEventObject&&(r=document.createEventObject(),e.extend(r,i),r.button={0:1,1:4,2:2}[r.button]||r.button),r},keyboardEvent:function(t,n){var r,i=e.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0},n);if(e.isFunction(document.createEvent))try{r=document.createEvent("KeyEvents"),r.initKeyEvent(t,i.bubbles,i.cancelable,i.view,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode)}catch(s){r=document.createEvent("Events"),r.initEvent(t,i.bubbles,i.cancelable),e.extend(r,{view:i.view,ctrlKey:i.ctrlKey,altKey:i.altKey,shiftKey:i.shiftKey,metaKey:i.metaKey,keyCode:i.keyCode,charCode:i.charCode})}else document.createEventObject&&(r=document.createEventObject(),e.extend(r,i));return e.browser!==undefined&&(e.browser.msie||e.browser.opera)&&(r.keyCode=i.charCode>0?i.charCode:i.keyCode,r.charCode=undefined),r},dispatchEvent:function(e,t,n){return e.dispatchEvent?e.dispatchEvent(n):e.fireEvent&&e.fireEvent("on"+t,n),n},drag:function(e){var t=this,n=this.findCenter(this.target),r=this.options,i=Math.floor(n.x),s=Math.floor(n.y),o=r.dx||0,u=r.dy||0,a=this.target,f={clientX:i,clientY:s};this.simulateEvent(a,"mousedown",f),f={clientX:i+1,clientY:s+1},this.simulateEvent(document,"mousemove",f),f={clientX:i+o,clientY:s+u},this.simulateEvent(document,"mousemove",f),this.simulateEvent(document,"mousemove",f),this.simulateEvent(a,"mouseup",f)},findCenter:function(t){var t=e(this.target),n=t.offset();return{x:n.left+t.outerWidth()/2,y:n.top+t.outerHeight()/2}}}),e.extend(e.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})}(jQuery),function(e){var t={numOfCol:5,offsetX:5,offsetY:5,blockElement:"div"},n,r,i=[];Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1});var s=function(){i=[];for(var e=0;e<t.numOfCol;e++)o("empty-"+e,e,0,1,-t.offsetY)},o=function(e,n,r,s,o){for(var u=0;u<s;u++){var a=new Object;a.x=n+u,a.size=s,a.endY=r+o+t.offsetY*2,i.push(a)}},u=function(e,t){for(var n=0;n<t;n++){var r=a(e+n,"x");i.splice(r,1)}},a=function(e,t){for(var n=0;n<i.length;n++){var r=i[n];if(t=="x"&&r.x==e)return n;if(t=="endY"&&r.endY==e)return n}},f=function(e,t){var n=[];for(var r=0;r<t;r++)n.push(i[a(e+r,"x")].endY);var s=Math.min.apply(Math,n),o=Math.max.apply(Math,n);return[s,o,n.indexOf(s)]},l=function(e){if(e>1){var t=i.length-e,n=!1,r,s;for(var o=0;o<i.length;o++){var u=i[o],a=u.x;if(a>=0&&a<=t){var l=f(a,e);n?l[1]<r[1]&&(r=l,s=a):(n=!0,r=l,s=a)}}return[s,r[1]]}return r=f(0,i.length),[r[2],r[0]]},c=function(e,n){!e.data("size")||e.data("size")<0?e.data("size",1):e.data("size")>t.numOfCol&&e.data("size",t.numOfCol);var i=l(e.data("size")),s=r*e.data("size")-(e.outerWidth()-e.width());e.css({width:s-t.offsetX*2,left:i[0]*r,top:i[1],position:"absolute"});var a=e.outerHeight();u(i[0],e.data("size")),o(e.attr("id"),i[0],i[1],e.data("size"),a)};e.fn.BlocksIt=function(o){o&&typeof o=="object"&&e.extend(t,o),n=e(this),r=n.width()/t.numOfCol,s(),n.children(t.blockElement).each(function(t){c(e(this),t)});var u=f(0,i.length);return n.height(u[1]+t.offsetY),this}}(jQuery)});