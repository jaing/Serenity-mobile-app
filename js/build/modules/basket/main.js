define(["jquery","backbone","text!modules/basket/tpl/index.tpl","models/product","modules/seatMap/main"],function(e,t,n,r,i){var s=t.Collection.extend({model:r});return t.View.extend({events:{"click .plus":"changeProductCount","click .minus":"changeProductCount","change input":"changeBasket","click .remove":"removeProductFromBasket","click .basket-confirm":"confirmOrder","click .go-back":"goBack"},initialize:function(e){Serenity.basket=new s,Serenity.basket.bind("add remove",this.handleBasketChange,this)},render:function(e,t){this.$el.html(_.template(e,t)).translate(),setTimeout(function(){Serenity.scrolls.basketScroll=new IScroll("#basket",{mouseWheel:!0,scrollbars:!0,fadeScrollbars:!0,click:!0,tap:!0})},100)},getData:function(){this.render(n,{products:Serenity.basket.toJSON()})},handleBasketChange:function(t,n){e("#app-header").find(".badge").html(n.length)},changeProductCount:function(t){t.preventDefault();var n=e(t.currentTarget).data("product-id"),r=this.$el.find("#basket-product-"+n+" input"),i=r.val();e(t.currentTarget).hasClass("plus")?(r.val(parseInt(i)+1),r.trigger("change")):i!=1&&(r.val(parseInt(i)-1),r.trigger("change"))},changeBasket:function(t){var n=e(t.currentTarget).data("product-id"),r=Serenity.basket.get(n).get("count");Serenity.basket.get(n).set("count",parseInt(e(t.currentTarget).val())),this.calculateTotal()},calculateTotal:function(){var t=0;e.each(Serenity.basket.toJSON(),function(e,n){t+=n.price.value*n.count}),this.$el.find("#basket-total .total").html(t.toFixed(2)+" "+Serenity.basket.toJSON()[0].price.currency)},removeProductFromBasket:function(t){t.preventDefault();var n=e(t.currentTarget).data("product-id");Serenity.basket.remove(n),this.getData()},confirmOrder:function(e){e.preventDefault(),Serenity.orderType==="seat"&&new i({el:"#step-2"}),this.$el.find("#step-1").removeClass("slideDown"),this.$el.find("#step-2").addClass("slideDown"),this.$el.find("#step-1").addClass("hidden"),this.$el.find("#step-2").removeClass("hidden"),Serenity.app.refreshScroll()},goBack:function(e){e.preventDefault(),this.$el.find("#step-2").removeClass("slideDown"),this.$el.find("#step-1").addClass("slideDown"),this.$el.find("#step-2").addClass("hidden"),this.$el.find("#step-1").removeClass("hidden"),Serenity.app.refreshScroll()}})});