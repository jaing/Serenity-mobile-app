define(["jquery","backbone","text!modules/products/tpl/index.tpl","models/product"],function(e,t,n,r){var i=t.Collection.extend({model:r});return t.View.extend({events:{"click .fb":"moreProductInfo","click .add-product":"addProduct"},initialize:function(e){this.getData()},render:function(t,n){this.$el.html(_.template(t,n)).translate(),setTimeout(function(){Serenity.scrolls.productsScroll=new IScroll("#app-body",{mouseWheel:!0,scrollbars:!0,fadeScrollbars:!0,click:!0,tap:!0}),e(".icon").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){return e(".tap").removeClass("active")})},100)},getData:function(){var t=this;Serenity.collections.Products=new i,this.collection=Serenity.collections.Products,e.ajax({url:"api/products.json",type:"GET",dataType:"JSON"}).done(function(e){t.collection.add(e),t.render(n,{products:t.collection.toJSON()})}).fail(function(e){Serenity.app.handleError(e)})},moreProductInfo:function(t){return t.preventDefault(),e(t.currentTarget).parents(".product").find(".more").toggleClass("hidden"),e(t.currentTarget).parents(".product").find(".more").toggleClass("slideDown"),e(t.currentTarget).find(".icon").toggleClass("active"),e(t.currentTarget).find(".tap").addClass("active")},addProduct:function(t){t.preventDefault();var n=e(t.currentTarget).data("product-id");Serenity.basket.get(n)?Serenity.basket.get(n).set("count",Serenity.basket.get(n).get("count")+1):Serenity.basket.add(_.extend(Serenity.collections.Products.get(n).toJSON(),{count:1})),Serenity.app.message("label.msg.productAddedToBasket")}})});