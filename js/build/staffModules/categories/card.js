define(["jquery","backbone","text!staffModules/categories/tpl/card.tpl","models/product"],function(e,t,n,r){var i=t.Collection.extend(),s=t.Collection.extend(),o=t.Collection.extend({model:r});return t.View.extend({events:{},initialize:function(e){this.options=e,this.getData()},render:function(e,t){this.$el.html(_.template(e,t)).translate()},getData:function(){var t=this,n={};Serenity.collections.Categories?(this.parseCategories(),this.options.state!="new"?this.renderEdit():this.renderNew()):(Serenity.collections.Categories=new i,this.collection=Serenity.collections.Categories,e.ajax({url:"api/categories.json",type:"GET",dataType:"JSON"}).done(function(e){t.collection.add(e),t.parseCategories(),t.options.state!="new"?t.renderEdit():t.renderNew()}).fail(function(e){Serenity.app.handleError(e)}))},renderEdit:function(){var t=Serenity.collections.AllCategoriesCollection.get(this.options.cId).toJSON(),r,i=this;Serenity.collections.Products=new o,e.ajax({url:"api/staffProducts.json",type:"GET",dataType:"JSON"}).done(function(e){Serenity.collections.Products.add(e),r=Serenity.collections.Products.toJSON(),i.render(n,{config:i.options,p:t,c:Serenity.collections.Categories.toJSON(),products:r}),i.loadForm(t)}).fail(function(e){Serenity.app.handleError(e)})},renderNew:function(){this.render(n,{config:this.options,p:{},c:Serenity.collections.Categories.toJSON()})},parseCategories:function(){Serenity.collections.AllCategoriesCollection=new s,e.each(Serenity.collections.Categories.toJSON(),function(t,n){Serenity.collections.AllCategoriesCollection.add(n),e.each(n.children,function(e,t){Serenity.collections.AllCategoriesCollection.add(t)})})},loadForm:function(e){console.log(e),this.$el.find('[name="id"]').val(e.id),this.$el.find('[name="name"]').val(Serenity.app.translate("label.categories."+e.id)),e.parent&&this.$el.find('[name="parent"]').val(e.parent)}})});