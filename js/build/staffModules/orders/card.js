define(["jquery","backbone","text!staffModules/orders/tpl/card.tpl","models/product"],function(e,t,n,r){var i=t.Collection.extend({model:r});return t.View.extend({events:{},initialize:function(e){this.options=e,this.getData()},render:function(e,t){this.$el.html(_.template(e,t)).translate(),this.$el.find('[name="status"]').val(t.o.status)},getData:function(){var t=this;Serenity.collections.Products=new i,e.ajax({url:"api/products.json",type:"GET",dataType:"JSON"}).done(function(e){Serenity.collections.Products.add(e),t.loadOrder()}).fail(function(e){Serenity.app.handleError(e)})},loadOrder:function(){var t=this;Serenity.collections.Orders&&Serenity.collections.Orders.get(this.options.oId)?(o=Serenity.collections.Orders.get(this.options.oId).toJSON(),t.renderOrder(o)):e.ajax({url:"api/order.json",type:"POST"}).success(function(e){t.renderOrder(e)})},renderOrder:function(t){var r=[];e.each(t.products,function(e,t){r.push(Serenity.collections.Products.get(t).toJSON())}),this.render(n,{products:r,o:t})}})});