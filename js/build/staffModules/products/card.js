define(["jquery","backbone","text!staffModules/products/tpl/card.tpl","models/product"],function(e,t,n){var r=t.Collection.extend();return t.View.extend({events:{"click .add-extended-body":"addExtendedBody","click .btn-language":"languageModal"},initialize:function(e){this.options=e,this.getData()},render:function(e,t){this.$el.html(_.template(e,t)).translate()},getData:function(){var t=this,i={};Serenity.collections.Categories=new r,e.ajax({url:"api/categories.json",type:"GET",dataType:"JSON"}).done(function(r){Serenity.collections.Categories.add(r),t.options.state!="new"&&Serenity.collections.Products&&Serenity.collections.Products.get(t.options.pId)?(i=Serenity.collections.Products.get(t.options.pId).toJSON(),t.render(n,{config:t.options,p:i,categories:Serenity.collections.Categories.toJSON()}),t.loadForm(i)):t.options.state!="new"?e.ajax({url:"api/product.json",type:"POST"}).success(function(e){t.render(n,{config:t.options,p:e,categories:Serenity.collections.Categories.toJSON()}),t.loadForm(e)}):t.render(n,{config:t.options,p:{},categories:Serenity.collections.Categories.toJSON()})}).fail(function(e){Serenity.app.handleError(e)})},addExtendedBody:function(t){t.preventDefault(),e(t.currentTarget).toggle(),e(t.currentTarget).next().toggleClass("hidden")},loadForm:function(e){this.$el.find('[name="id"]').val(e.id),this.$el.find('[name="name"]').val(Serenity.app.translate("label.product.name."+e.id)),this.$el.find('[name="body"]').val(Serenity.app.translate("label.product.body."+e.id)),this.$el.find('[name="status"]').val(e.status),this.$el.find('[name="price"]').val(e.price.value),this.$el.find('[name="category"]').val(e.category),this.$el.find('[name="currency"]').val(e.price.currency),this.$el.find('[name="discount"]').val(e.price.discount),e.hasExtendedBody&&this.$el.find('[name="extendedBody"]').val(Serenity.app.translate("label.product.extendedBody."+e.id)),e.isPromotion&&this.$el.find('[name="isPromotion"]').attr("checked",!0)},languageModal:function(t){t.preventDefault();var n=e(t.currentTarget).data("product-id");Serenity.modal.show("label.staff.languageSettings","asdasd",[{"class":"btn-primary",label:"label.staff.save",handler:function(){alert(123)}}])}})});